<!DOCTYPE html>
<html lang="en">

<head>
	<meta charset="utf-8">
	<meta name="viewport" content="width=device-width, initial-scale=1">
	<meta name="author" content="Godot Engine">
	<meta name="description" content="This is the second blog post describing enhancements for visual shaders and shader scripts landed in Godot 3.2. Much time and effort was spent adding a lot of new things to enhance the overall experience developing shaders.">
	<meta name="theme-color" content="#3d8fcc">
	<meta property="og:site_name" content="Godot Engine">
	<meta property="og:url" content="https://godotengine.org/article/major-update-visual-shaders-godot-3-2-part-2/">
	<meta name="twitter:site" content="@godotengine">

	<meta property="og:title" content="Major update for Visual Shaders in Godot 3.2 (part 2)">
	<meta property="og:description" content="This is the second blog post describing enhancements for visual shaders and shader scripts landed in Godot 3.2. Much time and effort was spent adding a lot of new things to enhance the overall experience developing shaders.">
	<meta property="og:image" content="https://godotengine.org/storage/app/uploads/public/5dc/1aa/e06/5dc1aae06d7f4636917764.png">
	<meta property="og:type" content="article">
	<meta name="twitter:card" content="summary_large_image">
	<title>Major update for Visual Shaders in Godot 3.2 (part 2)</title>

	<link rel="alternate" type="application/rss+xml" title="Godot News" href="/rss.xml">
	<link rel="icon" href="/assets/favicon.png" sizes="any">
	<link rel="icon" href="/assets/favicon.svg" type="image/svg+xml">
	<link rel="stylesheet" href="/assets/css/main.css?109">
	<link rel="stylesheet" href="/assets/css/tobii.min.css">
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-Bold.woff2" crossorigin>
	<link rel="preload" as="font" href="/assets/fonts/Montserrat-ExtraBold.woff2" crossorigin>
	<link rel="me" href="https://mastodon.gamedev.place/@godotengine">
</head>

<body>
	<input type="checkbox" id="nav_toggle_cb">
<header>
	<div class="container flex align-center">
		<div id="nav_head">
			<a href="/" id="logo-link">
				<img class="nav-logo" src="/assets/logo.svg" width="136" height="48" alt="Godot Engine">
				<img class="nav-logo dark-logo" src="/assets/logo_dark.svg" width="136" height="48" alt="Godot Engine">
			</a>
			<label for="nav_toggle_cb" id="nav_toggle_btn">
				<img src="/assets/icons/hamburger.svg" width="24" height="24" alt="Main menu">
			</label>
		</div>

		<nav id="nav">
			<ul class="left">
				<li><a href="/features">Features</a></li>
				<div class="only-on-mobile" style="width: 100%">
					<li><a href="/showcase">Showcase</a></li>
				</div>
				<li><a href="/blog">Blog</a></li>
				<li><a href="/community">Community</a></li>
				<li><a href="/contact">About</a></li>
				<li><a href="https://godotengine.org/asset-library/asset">Assets</a></li>
			</ul>

			<ul class="right">
				<li><a href="/download/windows" class="set-os-download-url">Download</a></li>
				<li><a href="https://docs.godotengine.org">Learn</a></li>
				<li><a href="https://docs.godotengine.org/en/stable/community/contributing/index.html">Contribute</a></li>
				
				<li class="fund"><a href="https://fund.godotengine.org">❤&#xFE0E; Donate</a></li>
			</ul>
		</nav>
	</div>
</header>

<main>


<style>
	body {
		background-color: var(--background-color);
	}

	h1 {
		margin-bottom: 8px;
		margin-top: 32px;
	}

	:not(pre)>code {
		background: var(--code-background-color);
		padding: 1px 4px;
		font-size: 0.95em;
		border-radius: 3px;
	}

	pre {
		background: var(--codeblock-background-color);
		color: var(--codeblock-color);
	}

	pre code {
		display: block;
		overflow-x: auto;
		padding: .5em;
	}

	.date-big {
		line-height: 2;
		margin-left: 32px;
	}

	article {
		background-color: var(--base-color);
		box-shadow: 0px 3px 2px 0px rgba(0, 0, 0, 0.15);
	}

	figure {
		margin: 0;
	}

	figure img {
		margin: 0;
	}

	article img,
	article video {
		max-width: 100%;
		height: auto;
		display: block;
		margin: auto;
		margin-top: 16px;
		margin-bottom: 16px;
	}

	article h1 {
		margin-top: 64px;
	}

	article h2,
	article h3,
	article h4 {
		margin-top: 42px;
	}

	.article-info {
		display: flex;
		flex-direction: column;
		gap: 8px;
	}

	.article-metadata {
		display: flex;
		gap: 24px;
		align-items: center;
		font-family: var(--header-font-family);
		margin-bottom: 12px;
	}

	@media (max-width: 900px) {
		.article-metadata {
			flex-direction: column;
			align-items: flex-start;
			gap: 16px;
		}
	}

	.article-author {
		color: var(--base-color-text-subtitle-date);
		font-weight: 700;
		font-size: 18px;
		flex-grow: 1;
		display: flex;
		gap: 12px;
		align-items: center;
	}

	.article-author .avatar {
		border-radius: 100%;
		margin: 0;
	}

	.article-author .by {
		color: var(--base-color-text-subtitle);
	}

	.article-metadata .date {
		color: var(--base-color-text-subtitle-date);
	}

	.tag.active {
		filter: saturate(0.75);
	}

	@media screen and (min-width: 900px) {
		article .content {
			width: 70%;
			margin: auto;
		}
	}

	@media (max-width: 900px) {
		body {
			background-color: var(--base-color);
		}

		article {
			background-color: transparent;
			box-shadow: none;
		}

		article img:first-child,
		article video:first-child {
			max-width: 100%;
		}
	}
</style>

<link rel="stylesheet" href="/assets/css/highlight.obsidian.min.css">

<div class="container">
	<article class="padded">
		<div class="content article-container">
			<figure class="article-cover">
				

				<img src="/storage/app/uploads/public/5dc/1aa/e06/5dc1aae06d7f4636917764.png" title=""
					alt=" " class="rounded-lg"
					style="width: 100%; height: auto" />
			</figure>

			<div class="article-info">
				<h1>
					Major update for Visual Shaders in Godot 3.2 (part 2)
				</h1>
				<div class="article-metadata">
					<div class="article-author">
						<span>By: </span>
						
						
							<img class="avatar" width="25" height="25" src="/assets/images/authors/default_avatar.svg" alt="Yuri Roubinsky" loading="lazy">
						
						<span class="by">Yuri Roubinsky</span>
					</div>
					<span class="date"> 11 November 2019</span>
				</div>

				<div class="tags">
					
					<a href="/blog/progress-report">
						<div class="tag active">Progress Report</div>
					</a>
					
				</div>
			</div>

			



	<div class="card card-warning">
		<p>
		
			This article is from <strong>November 2019</strong>, some of its contents might be outdated and no longer accurate.<br>
			You can find up-to-date information about the engine in the <a href="https://docs.godotengine.org/en/stable/">official documentation</a>.
		
		</p>
	</div>





			<div class="article-body">
				<p>This is the second blog post describing enhancements for visual shaders and shader scripts landed in Godot 3.2. You can read the <a href="https://godotengine.org/article/major-update-for-visual-shader-in-godot-3-2">first part here</a>.
Since the previous update, I’ve (Chaosus) spent much time and effort adding a lot of new things to enhance the overall experience developing shaders.</p>

<h2 id="shader-changes">Shader changes</h2>

<p>First, let’s have a look at shader scripts.</p>

<h3 id="constants-support">Constants support</h3>

<p>Constants can be used in global and local spaces. They may be better than uniforms in terms of performance, at the cost of not being accessible outside the shader. You can define multiple of them in a single line.</p>

<p><img src="/storage/app/media/vshader2019/constants.png" alt="Shader Constants" /></p>

<h3 id="local-arrays-support">Local arrays support</h3>

<p>It is now possible to define and use arrays inside functions.</p>

<p><img src="/storage/app/media/vshader2019/locarray.png" alt="Shader Local Array" /></p>

<h3 id="varyings-arrays">Varyings arrays</h3>

<p>Varyings types may also be used as arrays to pass multiple variables from the vertex function in a single variable.</p>

<p><img src="/storage/app/media/vshader2019/vararray.png" alt="Shader Varying Array" /></p>

<h3 id="dowhile-loops">Do/while loops</h3>

<p><code class="language-plaintext highlighter-rouge">do</code> was added as a keyword in Godot shaders which allows the standard C <code class="language-plaintext highlighter-rouge">do</code>/<code class="language-plaintext highlighter-rouge">while</code> combo inside your shaders like:</p>

<p><img src="/storage/app/media/vshader2019/do.png" alt="Shader Do" /></p>

<p>The expression after <code class="language-plaintext highlighter-rouge">do</code> will execute at last once, unlike standard <code class="language-plaintext highlighter-rouge">while</code> where it’s not guaranteed.</p>

<h3 id="switch-statements">Switch statements</h3>

<p><code class="language-plaintext highlighter-rouge">switch</code> was added for high-end backends (GLES3/Vulkan) as an operator similar to the standard C switch (due to OpenGL ES 2.0 limitations, it’s not available in the GLES2 backend). Multiple cases may fall through each other. The new <code class="language-plaintext highlighter-rouge">default</code> keyword may be used to define the common case behavior.</p>

<p><img src="/storage/app/media/vshader2019/switch.png" alt="Shader switch" /></p>

<h3 id="gles3-functions-in-gles2">GLES3 functions in GLES2</h3>

<p>Many functions have been implemented in the GLES2 backend to match GLES3. Those were not available in OpenGL ES 2.0’s version of GLSL, so we implemented our own shader standard library to provide them in both backends.</p>

<ul>
  <li><strong>sinh</strong></li>
  <li><strong>cosh</strong></li>
  <li><strong>tanh</strong></li>
  <li><strong>asinh</strong></li>
  <li><strong>acosh</strong></li>
  <li><strong>atanh</strong></li>
  <li><strong>determinant</strong></li>
  <li><strong>round</strong></li>
  <li><strong>roundEven</strong></li>
  <li><strong>inverse</strong></li>
  <li><strong>isnan</strong></li>
  <li><strong>isinf</strong></li>
  <li><strong>outerProduct</strong></li>
  <li><strong>transpose</strong></li>
  <li><strong>trunc</strong></li>
</ul>

<p>Their performance may be lower, compared to GLES3 countreparts, but its better than not having them at all.</p>

<p>Besides that, the unavailable GLES3 functions in GLES2 are now restricted from usage to prevent shader crashing.</p>

<h2 id="visual-shader-changes">Visual Shader changes</h2>

<h3 id="custom-nodes">Custom nodes</h3>

<p>This feature allows you to create your libraries of shader functions and use them within the editor or distribute them to other users. Its primary goal is to give users the possibility to implement code parts inside code modules as easily as possible. The following graph describes the process to create them:</p>

<p><img src="/storage/app/media/vshader2019/custom_nodes_steps2.png" alt="Custom Nodes Steps" /></p>

<p>You can even drag &amp; drop them to the graph from the FileSystem dock:</p>

<p><img src="/storage/app/media/vshader2019/custom_node_drop.gif" alt="Custom Nodes Drag&amp;Drop" /></p>

<h3 id="copypaste">Copy/paste</h3>

<p>You can now copy/paste nodes within the graph or between graphs (vertex/fragment/light). Use Control+C/V combo as usual. It works even for complex nodes such as Expressions.
The result will be posted under the cursor hotspot.</p>

<p><img src="/storage/app/media/vshader2019/vs_copy_paste.gif" alt="Copy/Paste Demo" /></p>

<h3 id="auto-connection">Auto connection</h3>

<p>When dragging the connection line from a port to an empty location, the node creation dialog will appear and if you use it to create a node, it will be automatically connected to that port.</p>

<p><img src="/storage/app/media/vshader2019/connection.gif" alt="Auto connection" /></p>

<h3 id="drag--drop-textures-from-filesystem">Drag &amp; drop textures from FileSystem</h3>

<p>You can now drag textures from the FileSystem dock to the graph. This will automatically create a Texture node with the associated texture for each dragged texture.</p>

<p><img src="/storage/app/media/vshader2019/texture_drop.gif" alt="Texture Drag&amp;Drop" /></p>

<h3 id="converter-from-visualshader-to-shader">Converter from VisualShader to Shader</h3>

<p>You can now convert visual shaders to shader scripts.</p>

<p><img src="/storage/app/media/vshader2019/convert_shader.png" alt="Shader Conversion" /></p>

<p>Note that the conversion is unidirectional, it’s not possible to convert script shaders to visual shaders. So make a copy or duplicate your visual shader before conversion if you want to preserve it for further changes in visual shader editor.</p>

<h3 id="generated-shader-preview">Generated shader preview</h3>

<p>This panel can be opened by pressing the shader preview button, which adds a new panel showing the generated shader script corresponding to your visual shader graph.</p>

<p><img src="/storage/app/media/vshader2019/result_panel.gif" alt="Shader Generated Code Panel" /></p>

<p>It shows the final code and if any error is generated, the corresponding line will be highlighted.
The code can be selected and copied from this panel, but not edited.</p>

<h3 id="compare-node">Compare node</h3>

<p><code class="language-plaintext highlighter-rouge">Compare</code> is a more powerful version of <code class="language-plaintext highlighter-rouge">If</code> - you may compare scalars, vectors, boolean and transforms, for any comparison operation. It is located under the Conditional tab in the members tree:</p>

<p><img src="/storage/app/media/vshader2019/compare0.png" alt="Compare node" /></p>

<p><img src="/storage/app/media/vshader2019/compare1.png" alt="Compare node" /></p>

<p>In scalar comparison you may define its tolerance:</p>

<p><img src="/storage/app/media/vshader2019/compare2.png" alt="Compare node" /></p>

<p>In vector comparison you may compare whether all of its components are equal or any of them:</p>

<p><img src="/storage/app/media/vshader2019/compare3.png" alt="Compare node" /></p>

<p>Boolean and transforms may only be compared for equality or inequality.</p>

<p>This node is perfectly designed to be used with the <code class="language-plaintext highlighter-rouge">Switch</code> node, since it accepts a boolean output from this node.</p>

<p><img src="/storage/app/media/vshader2019/compare4.png" alt="Compare node" /></p>

<p>Be careful not to use it too frequently since it may significantly decrease the shader performance.</p>

<h3 id="global-expressions">Global expressions</h3>

<p>You may define custom global code in these expressions. It will be added on top of the generated shader and can be used in standard Expressions:</p>

<p><img src="/storage/app/media/vshader2019/global_expression.png" alt="Global expression node" /></p>

<h3 id="is">Is</h3>

<p>This <code class="language-plaintext highlighter-rouge">Is</code> node is used to check whether the scalar variable is <code class="language-plaintext highlighter-rouge">INFINITY</code> or <code class="language-plaintext highlighter-rouge">NaN</code>.</p>

<p><img src="/storage/app/media/vshader2019/is_inf.png" alt="Is(Inf)" /></p>

<p><img src="/storage/app/media/vshader2019/is_nan.png" alt="Is(NaN)" /></p>

<h3 id="switch-for-scalars">Switch for scalars</h3>

<p>Boolean switch to choose from one of the scalars depending on the boolean value.
Be careful not to use it too frequently since it may significantly decrease the shader performance.</p>

<p><img src="/storage/app/media/vshader2019/scalar_switch.png" alt="Scalar Switch" /></p>

<h3 id="default-uv-parameter-for-texture">Default UV parameter for Texture</h3>

<p>The <code class="language-plaintext highlighter-rouge">Texture</code> node’s <code class="language-plaintext highlighter-rouge">uv</code> input port no longer requires to be connected to a <code class="language-plaintext highlighter-rouge">UV</code> node - it is used internally by default!</p>

<p><img src="/storage/app/media/vshader2019/texture0.png" alt="Texture Default UV" /></p>

<h3 id="textureuniformtriplanar">TextureUniformTriplanar</h3>

<p>This <code class="language-plaintext highlighter-rouge">TextureUniformTriplanar</code> node is available only in Spatial shaders in the fragment function.  Parameters <code class="language-plaintext highlighter-rouge">weights</code> and <code class="language-plaintext highlighter-rouge">pos</code> are overrides by default. It’s a big, complex function as you can see in the generated code panel.</p>

<p><img src="/storage/app/media/vshader2019/triplanar.png" alt="Texture Triplanar" /></p>

<h3 id="sampler-type">Sampler type</h3>

<p>The Sampler type was most recently added, to help developers with handling texture samplers. Internally, it is a name reference to an existing uniform or pre-defined sampler input.</p>

<p>The texture uniforms get a new port that returns it. To use it, you can connect it to a Texture, Expression or custom node with the allowed port. If you connect it to a Texture node, the new SamplerPort option must be used to handle the input from the sampler.</p>

<p><img src="/storage/app/media/vshader2019/texture1.png" alt="Texture SamplerPort" /></p>

<p>Since it’s just a name reference and shaders cannot pass them to local variables, the Expressions can accept sampler but cannot return them (at least for now).</p>

<p>I’ve also added predefined samplers such as ScreenTexture, Depth or Texture (Texture2D for CanvasItem shader type).</p>

<p><img src="/storage/app/media/vshader2019/sampler_inputs0.png" alt="Sampler Inputs" /></p>

<p>They can be used with custom nodes or Texture:</p>

<p><img src="/storage/app/media/vshader2019/sampler_inputs.png" alt="Sampler Inputs" /></p>

<h2 id="summary">Summary</h2>

<p>Godot provides an awesome layer for graphics developers, and with provided changes it can do many new things in an easier and better way. For 4.0, I hope to continue enjoying myself and make shader fun more accessible by providing new enchancements and feature proposals.</p>

<p>If you like my work and want to support me, I’m happy to receive donations (see relevant options on <a href="https://github.com/Chaosus">my GitHub profile</a>).</p>

<p><strong>Thanks Arkology for providing examples of custom visual shader nodes. You can download his <a href="https://github.com/arkology/ShaderV">VisualShader plugin on GitHub</a>.</strong></p>

			</div>
		</div>
	</article>
</div>

<link rel="stylesheet" href="/assets/css/anchor-link.css?1">
<link rel="stylesheet" href="/assets/css/article-cards.css?1">
<script src="/assets/js/anchor-link.js"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// Add icons to easily copy section links.
		window.applyAnchorLinks('.article-body');

		// Add lightbox elements in blog articles for Tobii.
		document.querySelectorAll('.article-cover img, .article-body img').forEach((articleImg) => {
			if (articleImg.classList.contains('lightbox-ignore')) {
				return;
			}

			const lightbox = document.createElement('a');
			lightbox.href = articleImg.src;
			lightbox.classList.add('lightbox');
			lightbox.dataset.group = 'article';
			articleImg.parentNode.appendChild(lightbox);
			lightbox.appendChild(articleImg);
		});
	});
</script>

</main>

<footer>
	<div class="container flex footer-container">
		<div id="copyright">
			<p>
				© 2007-2023 Juan Linietsky, Ariel Manzur and <a
					href="https://github.com/godotengine/godot/blob/master/AUTHORS.md" target="_blank"
					rel="noopener">contributors</a>.<br>
				Hosted by the <a href="https://godot.foundation/" target="_blank" rel="noopener">Godot Foundation</a>.<br>
				Website <a href="https://github.com/godotengine/godot-website" target="_blank" rel="noopener">source code on  GitHub</a>.
			</p>
		</div>
		<div id="sitemap">
			<ul class="sitemap-group">
				<li><strong>Get Godot</strong></li>
				<li><a href="/download/windows" class="set-os-download-url">Download</a></li>
				<li><a href="https://editor.godotengine.org/releases/latest/">Web Editor</a></li>
				<li>&nbsp;</li>
				<li><strong>Public Relations</strong></li>
				<li><a href="/blog">Blog</a></li>
				<li><a href="/community">Communities and Events</a></li>
				<li><a href="/press">Press Kit</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>About Godot</strong></li>
				<li><a href="/features">Features</a></li>
				<li><a href="/showcase">Showcase</a></li>
				<li><a href="/education">Education</a></li>
				<li><a href="/license">License</a></li>
				<li><a href="/code-of-conduct">Code of Conduct</a></li>
				<li><a href="/privacy-policy">Privacy Policy</a></li>
				<li><a href="https://fund.godotengine.org">Donate</a></li>
			</ul>
			<ul class="sitemap-group">
				<li><strong>Project Team</strong></li>
				<li><a href="/governance">Governance</a></li>
				<li><a href="/teams">Teams</a></li>
				<li>&nbsp;</li>
				<li><strong>Extra Resources</strong></li>
				<li><a href="/asset-library/asset">Asset Library</a></li>
				<li><a href="https://docs.godotengine.org">Documentation</a></li>
				<li><a href="https://github.com/godotengine">Code Repository</a></li>
			</ul>
		</div>
		<div id="social" class="dark-desaturate">
			<h4 class="text-right"><a href="/contact">Contact us</a></h4>
			<div class="flex justify-space-between" style="gap: 3px;">
				<a href="https://github.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/github_logo.svg" width="32" height="32" alt="GitHub">
				</a>
				<a href="https://mastodon.gamedev.place/@godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/mastodon_logo.svg" width="32" height="32" alt="Mastodon">
				</a>
				<a href="https://twitter.com/godotengine" target="_blank" rel="noopener">
					<img src="/assets/footer/twitter_logo.svg" width="32" height="32" alt="Twitter">
				</a>
				<a href="https://www.facebook.com/groups/godotengine/" target="_blank" rel="noopener">
					<img src="/assets/footer/facebook_logo.svg" width="32" height="32" alt="Facebook">
				</a>
				<a href="https://www.reddit.com/r/godot" target="_blank" rel="noopener">
					<!-- Zero-width space in the `alt` text to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/reddit_logo.svg" width="32" height="32" alt="Red​dit">
				</a>
				<a href="/rss.xml" target="_blank" rel="noopener">
					<!-- Icon is called `feed` instead of `rss` to prevent content blockers from blocking the icon -->
					<img src="/assets/footer/feed_logo.svg" width="32" height="32" alt="RSS feed">
				</a>
			</div>
		</div>
	</div>
</footer>

<script defer src="/assets/js/tobii.min.js"></script>
<script defer src="/assets/js/highlight.min.js?1"></script>
<script defer src="/assets/js/highlight.gdscript.min.js?1"></script>
<script>
	document.addEventListener('DOMContentLoaded', () => {
		// This needs to be done on page load but also after page changes,
		// in case a code block appears in an article.
		document.querySelectorAll('pre code').forEach((block) => {
			hljs.highlightBlock(block);
		});

		// Initialize lightbox.
		new Tobii({
			zoom: false,
		});

		// Update any download link to point to identified user's OS.
		const links = document.querySelectorAll('.set-os-download-url');
		for (let i = 0; i < links.length; i++) {
			const link = links[i];
			let link_slug = 'download';
			if ('version' in link.dataset && link.dataset['version'] === '3') {
				link_slug = 'download/3.x';
			}

			let link_platform = 'windows';
			if (navigator.platform.indexOf('Mac') !== -1) {
				link_platform = 'macos';
			} else if (navigator.platform.indexOf('Linux') !== -1) {
				link_platform = 'linux';
			}

			link.href = `/${link_slug}/${link_platform}`;
		}
	});
</script>


</body>

</html>
